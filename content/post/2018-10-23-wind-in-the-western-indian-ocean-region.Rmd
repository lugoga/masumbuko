---
title: Wind in the western Indian ocean region
author: Masumbuko Semba
date: '2018-10-23'
slug: wind-in-the-western-indian-ocean-region
categories:
  - Oceanography
tags:
  - Indian Ocean
  - Satellite
  - quikscat
---

The list of erddap data set and server are found at https://coastwatch.pfeg.noaa.gov/erddap/metadata/fgdc/xml/.
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, comment = "")
```

## Comparisons of Wind Stress
A problem faced when using satellite based estimates of wind stress is that the QuikSCAT based estimates start in 1999-07-21 and end in 2009-11-19, while the ASCAT based estimates start in 2009-10-03 and are ongoing. A comparison of the data over the period of overlap would be of interest.

```{r}
require(sf)
require(tidyverse)
require(lubridate)
require(oce)
require(rerddap)
require(gganimate)
```



```{r include=FALSE, warning=FALSE, echo=FALSE}
#NOT these is hidden in the output, but it is the one that does the processing of the three chunk above which are simply for for display but never execute as I parsed the argument eval = FALSE in them

##read Africa continental shapefile that we will use throught the munuscript as basemap dataset for maps
africa = read_sf("E:/GIS/Tanzania spatial data Bank/EAF14 Tanzania spatial datasets/africa/Spatial/AdmInfr/afcntry.shp")
```

extract centroid from polygones
```{r}

centroids = africa%>% 
  st_centroid() %>% 
  st_coordinates() %>% 
  as.tibble() %>%
  rename(lon = 1, lat = 2)
```


merge countries name with centroid 
```{r}
# make a copy of africa
country = africa

# remove the geometry and retain the attribute information of the africa countries
st_geometry(country) = NULL

# bind the country centroid information with the country attribute information 
country.centroids = centroids %>% 
  bind_cols(country) %>% 
  # drop other variables except lon, lat and name
  select(lon,lat, name = CNTRY_NAME)

# select the countries in the wio region
country.wio = country.centroids %>% 
  filter(name %in% c("Somalia", "Kenya", "Uganda", "Tanzania", 
                     "Mozambique", "South Africa","Madagascar", "Comoros",
                     "Seychelles", "Mauritius", "Reunion"))
```

Table \@ref(tab:tab1) show the longitude and latitude and name of the countries in the western Indian Ocean region
```{r tab1}
country.wio %>% 
  kableExtra::kable("html", col.names = c("Longitude", "Latitude", "Country"), align = "c",
                    caption = "Geographical information of the countries in the Western Indian Ocean Region") %>%
  kableExtra::column_spec(column = 1:3, width = "8cm")
```


Figure \@ref(fig:fig1) shows the country within the western Indian Ocean region
 
```{r fig1, fig.cap="Countries in the western Indian Ocean region", fig.height=8}
ggplot() + 
  geom_sf(data = spData::world, col = 1, fill = "ivory")+
  coord_sf(xlim = c(30,60), ylim = c(-30,5))+
  ggrepel::geom_text_repel(data = country.wio, 
            aes(x = lon, y = lat, label = name), nudge_x = 0.05)+
  theme_bw() + 
  theme(panel.background = element_rect(fill = "lightblue"),
        axis.text = element_text(size = 11, colour = 1),
        panel.grid = element_line(colour = NA))+
  scale_x_continuous(breaks = c(35,55))+
  scale_y_continuous(breaks = c(-25, 2)) +
  ggsn::scalebar(location = "bottomright", x.min = 35, x.max = 60,
                 y.min = -30, y.max = 5, dist = 600, dd2km = TRUE, 
                 model = "WGS84", st.dist = 0.02, st.size = 4)+
  labs(x = NULL, y = NULL)

```



##Subsetting griddap()
```{r eval=FALSE}
info("erdQSstress8day_LonPM180")
```

We can subset ERDDAP grids by setting limits on the dimension variables, the difference being that a subset is defined in coordinate space (latitude and longitude values) and temperal space( time values). Thus for `erdQSstress8day_LonPM180` if the desired area of the data extract is latitude limits of (7S, 4S), longitude limits of (38E, 41E), and with time limits of (2017-01-01, 2017-01-05) the following would be passed to the function griddap():
```{r, eval=FALSE}

lon = c(25,65)
lat =  c(-35,10)
time = c("2000-01-01", "2008-12-31")

wind = info('erdQSstress8day_LonPM180')

wo.wind = griddap(x = wind, 
                  longitude = lon, 
                  latitude = lat, 
                  time = time)

```

Geostrophic current
```{r , eval=FALSE}
geoinfo = info("erdTAgeo1day_LonPM180")

lon = c(25,65)
lat =  c(-35,10)
time = c("1993-01-01", "2012-12-07")

geostrophic = griddap(geoinfo, longitude = lon, latitude = lat, 
                       time = time, fields = c("u_current", "v_current"))


```


```{r eval=FALSE}
wio.geostrophic =  geostrophic %>% 
  mutate(date = as.Date(time),
         vel = sqrt(u_current^2+ v_current^2)) %>%
  select(date, lon,lat, u = u_current, v = v_current, vel) %>%
  filter(date >= dmy(010112))


```


```{r echo=FALSE}

wio = read_csv("E:/Data Manipulation/rerddap/wio.csv")
```

Table \@ref(tab:tab2)
```{r tab2}
wio %>% sample_n(15) %>%
  kableExtra::kable("html", col.names = c("Date","Longitude", "Latitude", "Zonal (U)", 
                                          "Meridional (V)","Velocity"), 
                    align = "c", digits = 4,   
                    caption = "wind data in the Western Indian Ocean Region")  %>%
  kableExtra::column_spec(column = 1:6, width = "8cm") %>%
  kableExtra::add_header_above(c("", "Geographical Location" = 2, "Current Velocity" = 3))
```


decompose day, month, and year as separate variable from the date variable

```{r}
# decompose day, month, and year as separate variable from the date variable
wio = wio %>% 
  mutate(day = day(date), month = month(date) %>%
           as.integer(), year = year(date)%>%
           as.integer()) 
## group current based on longitude, latitude and month
wio.month = wio %>% group_by(lon,lat,month) %>% 
  summarise(u = mean(u, na.rm = T),v = mean(v, na.rm = T), vel= mean(vel, na.rm = T))

## ungroup grouped data frame
wio.month = wio.month %>% ungroup()
```


Figure \@ref(fig:fig2) shows monthly dynamics of ocean current in the WIO region

```{r fig2, fig.cap="monthly mean Current in the western Indian Ocean region", fig.height=8}

ggplot() +
  geom_raster(data = wio.month, 
              aes(x = lon, y = lat, fill = vel), interpolate = TRUE)+ 
  geom_sf(data = spData::world, col = 1, fill = "ivory")+
  coord_sf(xlim = c(30,60), ylim = c(-30,5))+
  ggrepel::geom_text_repel(data = country.wio, 
            aes(x = lon, y = lat, label = name), nudge_x = 0.05)+
  theme_bw() + 
  theme(panel.background = element_rect(fill = "lightblue"),
        axis.text = element_text(size = 11, colour = 1),
        panel.grid = element_line(colour = NA), 
        legend.key.height = unit(3, "lines"),
        legend.position = c(.92,.25),
        legend.background = element_rect(colour = 1))+
  scale_x_continuous(breaks = c(35,55))+
  scale_y_continuous(breaks = c(-25, 2)) +
  labs(x = NULL, y = NULL) +
  scale_fill_gradientn(colours = oceColors9A(120))+
  labs(title = 'Month: {frame_time}') +
  transition_time(month) +
  ease_aes('linear')
```

